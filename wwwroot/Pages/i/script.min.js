function _SearchFind(){let n=document.querySelector("#"+searchHeaderQHtmlBox.Name+" input").value.toLowerCase();userLogin.length>0&&(n="-"+userLogin+"-"+n);n.length>0&&(window.location.href="/i/"+n)}async function ApiUserBio(n){const t=await fetch(PageModuleUse.UrlApi+"/RtInk/User?userLogin="+n,{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+PageModuleUse.Session.Token}});return t.ok===!0?await t.json():null}async function ApiUserSubscrib(n){const t=await fetch(PageModuleUse.UrlApi+"/Base/User/Subscrib?userLogin="+n,{method:"POST",headers:{Accept:"application/json",Authorization:"Bearer "+PageModuleUse.Session.Token}});return t.ok===!0?await t.json():null}async function ApiArticleBookmarkGet(n){const t=await fetch(PageModuleUse.UrlApi+"/RtInk/ArticleBookmark?urlShort="+n,{method:"GET",headers:{Authorization:"Bearer "+PageModuleUse.Session.Token}});return t.ok===!0?await t.json():null}async function ApiArticleBookmarkPost(n){const t=await fetch(PageModuleUse.UrlApi+"/RtInk/ArticleBookmark?urlShort="+n,{method:"POST",headers:{Authorization:"Bearer "+PageModuleUse.Session.Token}});return t.ok}import{Page}from"/PageComponents/Page/script.min.js";import{HeaderHtmlBox}from"/PageComponents/HeaderHtmlBox/script.min.js";import{HeaderDescriptionHtmlBox}from"/PageComponents/HeaderDescriptionHtmlBox/script.min.js";import{HeaderTitleDescriptionHtmlBox}from"/PageComponents/HeaderTitleDescriptionHtmlBox/script.min.js";import{SearchHeaderQHtmlBox}from"/PageComponents/SearchHeaderQHtmlBox/script.min.js";import{ArticlesHtmlBox}from"/PageComponents/ArticlesHtmlBox/script.min.js";let PageModuleUse=new Page({name:"i",title:"News aggregator - RT",description:'RT - точка сбора самых интересных и актуальных новостей российских онлайн-медиа. "Картина дня" формируется автоматически на базе популярности материалов.'});await PageModuleUse.Build();let HeaderHtmlBoxModuleUse=new HeaderHtmlBox(PageModuleUse.MinifiedCode),HeaderTitleDescriptionHtmlBoxModuleUse=new HeaderTitleDescriptionHtmlBox(PageModuleUse.MinifiedCode),SearchHeaderQHtmlBoxModuleUse=new SearchHeaderQHtmlBox(PageModuleUse.MinifiedCode),search="",urlSrplit=document.URL.split("/");urlSrplit.length>4&&(search=decodeURIComponent(urlSrplit[4]));let typeApiPageI=0,userLogin="";if(search.length>0){let n=search.split("-");n.length>0&&(search[0]=="-"?(typeApiPageI=1,userLogin=n[1]):typeApiPageI=n.length==2&&n[1].length==0&&search[search.length-1]=="-"?2:3)}let HeaderTitle="RT",headerDescriptionName="",placeholder="",subscribType=0,userTitle="",userDescription="";if(typeApiPageI==0)headerDescriptionName="NEWS",HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/search.png",href:"",id:"SearchBM",alt:"search"}),PageModuleUse.Session.RoleId==0?(HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/location.png",href:"/locations",id:"LocationBM",alt:"location"}),localStorage.setItem("SessionRefrshRequired","true"),HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/login.png",href:PageModuleUse.UrlApi+"/Base/Authorization/Signin/Google?SessionToken="+PageModuleUse.Session.Token+"&RedirectUrl="+document.URL})):HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/category.png",href:"/users",alt:"signin"});else if(typeApiPageI==1){HeaderTitle="";let n=await ApiUserBio(userLogin);if(subscribType=n.sbt,userTitle=n.title,userDescription=n.description,PageModuleUse.Session.RoleId>0)if(subscribType!=1){let n=PageModuleUse.UrlContent+"/doubleCheckBlackBlack.png";subscribType==2?n=PageModuleUse.UrlContent+"/doubleCheckBlackRed.png":subscribType==3?n=PageModuleUse.UrlContent+"/doubleCheckRedBlack.png":subscribType==4&&(n=PageModuleUse.UrlContent+"/doubleCheckRedRed.png");HeaderHtmlBoxModuleUse.PushMenuRow({icon:n,href:"",id:"SubsribB"})}else HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/add.png",href:""}),HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/settings.png",href:""});if(search.split("-").length>2){let n=search.split("-");for(var i=2;i<n.length;i++)placeholder+=n[i]+" ";placeholder=placeholder.trim().toUpperCase()}HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/search.png",href:"",id:"SearchBM"});let t="/";PageModuleUse.Session.RoleId>0&&(t="/users");HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/undo.png",href:t})}else typeApiPageI==2?(HeaderHtmlBoxModuleUse="ARTICLE",HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/bookmark.png",id:"BookmarkB"}),HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/undo.png",href:"/"})):typeApiPageI==3&&(headerDescriptionName="SEARCH",placeholder=search.toUpperCase().replaceAll("-"," "),HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/search.png",href:"",id:"SearchBM"}),HeaderHtmlBoxModuleUse.PushMenuRow({icon:PageModuleUse.UrlContent+"/undo.png",href:"/"}));HeaderHtmlBoxModuleUse.InsertAdjacentHTML(document.getElementsByTagName("body")[0],"afterbegin",HeaderTitle);let idxy="HeaderDescriptionHtmlBox";if(headerDescriptionName.length>0?new HeaderDescriptionHtmlBox(PageModuleUse.MinifiedCode).InsertAdjacentHTML(document.getElementById("HeaderHtmlBox"),"afterend",headerDescriptionName):idxy="HeaderHtmlBox",SearchHeaderQHtmlBoxModuleUse.InsertAdjacentHTML(document.getElementById(idxy),"afterend",placeholder),typeApiPageI==1)search.split("-").length>2&&(document.getElementById("SearchHeaderQHtmlBox").style.display="block",document.getElementById("SearchBM").style.display="none");else if(typeApiPageI==2){let n=await ApiArticleBookmarkGet(search.substring(0,search.length-1));n.ok?document.getElementById("BookmarkB").querySelector("img").setAttribute("src",PageModuleUse.UrlContent+"/bookmarkSelected.png"):document.getElementById("BookmarkB").querySelector("img").setAttribute("src",PageModuleUse.UrlContent+"/bookmark.png")}else typeApiPageI==3&&(document.getElementById("SearchHeaderQHtmlBox").style.display="block",document.getElementById("SearchBM").style.display="none");let prevBoxName="SearchHeaderQHtmlBox";userLogin.length>0&&(userTitle==""&&(userTitle=userLogin.toUpperCase()),userDescription==""&&(userDescription="User and his articles."),PageModuleUse.Session.RoleId==2&&(userDescription+=' <a href="/user/edit/'+userLogin+'">Edit profile<\/a>'),HeaderTitleDescriptionHtmlBoxModuleUse.InsertAdjacentHTML(document.getElementById("SearchHeaderQHtmlBox"),"afterend",userTitle.toUpperCase(),userDescription),prevBoxName=HeaderTitleDescriptionHtmlBoxModuleUse.Name);let articlesHtmlBox=new ArticlesHtmlBox(document.getElementById(prevBoxName),"afterend",search,PageModuleUse);await articlesHtmlBox.AppendList();document.getElementById("BookmarkB")!=null&&document.getElementById("BookmarkB").addEventListener("click",async()=>{let n=await ApiArticleBookmarkPost(search.substring(0,search.length-1));n&&(document.getElementById("BookmarkB").querySelector("img").getAttribute("src")==PageModuleUse.UrlContent+"/bookmark.png"?document.getElementById("BookmarkB").querySelector("img").setAttribute("src",PageModuleUse.UrlContent+"/bookmarkSelected.png"):document.getElementById("BookmarkB").querySelector("img").setAttribute("src",PageModuleUse.UrlContent+"/bookmark.png"))});let prevScrollY=window.scrollY;document.addEventListener("scroll",async()=>{window.scrollY>=prevScrollY&&document.body.scrollHeight-window.scrollY<document.body.clientHeight+100&&(prevScrollY=window.scrollY+200,await articlesHtmlBox.AppendList())});document.getElementById("SearchBM").addEventListener("click",async()=>{document.getElementById("SearchBM").style.display="none",document.getElementById("SearchHeaderQHtmlBox").style.display="block"});document.getElementById("SubsribB")!=null&&document.getElementById("SubsribB").addEventListener("click",async()=>{let n=await ApiUserSubscrib(userLogin);n.ok&&(subscribType==0?(subscribType=2,document.querySelector("#SubsribB img").setAttribute("src",iPageUrlContent+"/doubleCheckBlackRed.png")):subscribType==2?(subscribType=0,document.querySelector("#SubsribB img").setAttribute("src",iPageUrlContent+"/doubleCheckBlackBlack.png")):subscribType==3?(subscribType=4,document.querySelector("#SubsribB img").setAttribute("src",iPageUrlContent+"/doubleCheckRedRed.png")):subscribType==4&&(subscribType=3,document.querySelector("#SubsribB img").setAttribute("src",iPageUrlContent+"/doubleCheckRedBlack.png")))});document.querySelector("#"+searchHeaderQHtmlBox.Name+" > a").addEventListener("click",()=>{_SearchFind()});document.querySelector("#"+searchHeaderQHtmlBox.Name+" input").addEventListener("keypress",async n=>{n.key=="Enter"&&_SearchFind()});
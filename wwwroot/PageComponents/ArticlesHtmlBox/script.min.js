import{MoreButtonHtmlBox}from"/PageComponents/MoreButtonHtmlBox/script.js";export class ArticlesHtmlBox{Target
    Position
    Search
    ApiUrl
    AuthJWToken
    MinifyExpansion
    Page
    UrlContent
    Take
    constructor(target,position,search,apiUrl,authJWToken,MinifyExpansion){this.Target=target;this.Position=position;this.Search=search;this.ApiUrl=apiUrl;this.AuthJWToken=authJWToken;this.MinifyExpansion=MinifyExpansion;let url="/PageComponents/"+this.constructor.name;this.UrlContent=url+"/content";let css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("href",url+"/style.min.css");document.head.append(css);this.Page=1;this.Take=20}async AppendList(){let list=await this.ApiAticles();if(this.Page==1&&(this.Target.insertAdjacentHTML(this.Position,this.HtmlPart()),list.length==this.Take)){let moreButtonHtmlBox=new MoreButtonHtmlBox(document.getElementById(this.constructor.name),"beforeend",this.MinifyExpansion);document.getElementById(moreButtonHtmlBox.Name).addEventListener("click",()=>{let list=await this.ApiAticles();list.forEach(e=>{document.querySelector("#"+this.constructor.name+" > ul").insertAdjacentHTML("beforeend",this.ItemHtmlBox(e)),this.LoadImages(e.titleHb,e.fileUrlSource,e.fileId,e.extension),e.description.length>0&&e.isBody&&document.querySelector('article[data-titleHb="'+e.titleHb+'"] ._Description').addEventListener("click",()=>{this.AppendBody(e.titleHb)})});this.Page++})}list.forEach(e=>{document.querySelector("#"+this.constructor.name+" > ul").insertAdjacentHTML("beforeend",this.ItemHtmlBox(e)),e.rating!=4&&this.LoadImages(e.titleHb,e.fileUrlSource,e.fileId,e.extension),e.rating==-9223372036854776000&&this.AppendBody(e.titleHb),e.description.length>0&&e.isBody&&document.querySelector('article[data-titleHb="'+e.titleHb+'"] ._Description').addEventListener("click",()=>{this.AppendBody(e.titleHb)})});this.Page++}HtmlPart(){return'        <div id="'+this.constructor.name+'">            <ul>            <\/ul>        <\/div>'}ItemHtmlBox(e){return'        <li>            <article data-titleHb="'+e.titleHb+'" data-tp="'+e.rating+'" data-isBody="'+e.isBody+'">                <div>                    <h1>                        <a href="/i/'+e.urlShort+'-">                        '+e.title+'                        <\/a>                    <\/h1>                <\/div>                <img alt="'+e.title+'" src="'+e.fileUrlSource+'" />                <div class="_Description">                '+e.description+'                <\/div>                <div class="_footer">                    <a href="/i/-'+e.login.toLowerCase()+'">                        <span>                        '+e.login+"                        <\/span>                    <\/a>                    <span>                    "+this.ConvertDatetimeToShortFormat(e.dt)+'                    <\/span>                    <a href="/a/'+e.urlShort+'">                        <span>                            SOURCE                        <\/span>                    <\/a>                <\/div>            <\/article>        <\/li>'}ConvertDatetimeToShortFormat(datetime){let s="";const months=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"];let dt=new Date(datetime),dtnow=new Date;dt.setHours(dt.getHours()+dt.getTimezoneOffset()/-60);let mm=dt.getMinutes().toString();mm.length==1&&(mm="0"+mm);const dtstrbase=months[dt.getMonth()]+" "+dt.getDate()+", "+dt.getFullYear()+" · "+dt.getHours()+":"+mm;s=dtstrbase;let minago=parseFloat(Date.now()-dt)/6e4;return minago>60?(new Date).getFullYear()==dt.getFullYear()&&(s=dtnow.getDate()==dt.getDate()?dt.getHours()+":"+mm:months[dt.getMonth()]+" "+dt.getDate()+" · "+dt.getHours()+":"+mm):s="",s}LoadImages(titleHb,fileUrlSource,fileId,extension){let tr=document.querySelector('article[data-titleHb="'+titleHb+'"]'),trg=tr.querySelector("img"),img=new Image(trg);img.onload=function(){trg.style.display="flex"};img.onerror=function(){let srcQ="https://rt.ink/f/"+fileId+"."+extension.trim();trg.setAttribute("src",srcQ);let imgQ=new Image;imgQ.onload=function(){trg.style.display="flex"};imgQ.src=srcQ};img.src=fileUrlSource}async AppendBody(titleHb){let bodyObj=await this.ApiArticleBody(titleHb);if(bodyObj!=null&&bodyObj.body.length>0){let tr=document.querySelector('article[data-titleHb="'+titleHb+'"]'),dsT=tr.querySelector("._Description");dsT.innerHTML=bodyObj.body;dsT.setAttribute("data-body",!0);dsT.setAttribute("data-isDescription",!0)}}async ApiAticles(){const response=await fetch(this.ApiUrl+"/RtInk/Articles?search="+this.Search+"&take="+this.Take+"&page="+this.Page,{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+this.AuthJWToken}});return response.ok==!0?await response.json():null}async ApiArticleBody(titleHb){const response=await fetch(this.ApiUrl+"/RtInk/ArticleBody?titleHb="+titleHb.toString(),{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+this.AuthJWToken}});return response.ok==!0?await response.json():null}}
export class LocsHtmlBox{_Target
    _Position
    _ApiUrl
    _SessionToken
    _RoleId

    _UrlContent
    _CheckedList

    Name
    Page

    constructor(n,t,i,r,u){this._Target=n;this._Position=t;this._ApiUrl=i;this._SessionToken=r;this._RoleId=u;this.Name=this.constructor.name;let e="/PageComponents/"+this.Name;this._UrlContent=e+"/content";let f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("href",e+"/style.min.css");document.head.append(f);this.Page=1}async AppendList(){let n=await this._ApiUsersAsLocations();n!=null&&n.length>0&&(this.Page==1&&(this._Target.insertAdjacentHTML(this._Position,this._HtmlPart()),this._CheckedList=await this._ApiUsersLocationsChecked()),n.forEach(n=>{document.querySelector("#"+this.Name+" > ul").insertAdjacentHTML("beforeend",this._ItemHtmlBox(n.login)),n.hasChildrens&&this._MoreChildrensButtonHtmlBoxAppend(n.login),document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"] ._SelectLocB')!=null&&document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"] ._SelectLocB').addEventListener("click",async()=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"]'),i=t.getAttribute("data-issubscribed"),r=await this._ApiUserSubscriptionSet(n.login);r.ok&&(i=="true"?t.setAttribute("data-issubscribed",!1):t.setAttribute("data-issubscribed",!0),this._CheckedList=await this._ApiUsersLocationsChecked())})}),this._CheckedList.length>0&&this._CheckedList.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"]');t!=null?t.setAttribute("data-issubscribed",!0):n.parentLogins.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"]');t.getAttribute("data-issubscribed")=="false"&&t.setAttribute("data-issubscribed","wait")})}))}async _MoreChildrensButtonHtmlBoxAppend(n){let t='<a class="_HasChildrensB">    <img src="'+this._UrlContent+'/arrow-down-black.png" /><\/a>';document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"]').insertAdjacentHTML("beforeend",t);document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"] ._HasChildrensB').addEventListener("click",async t=>{let i=t.target.closest("._HasChildrensB"),r=i.getAttribute("data-loading");if(r==null||r=="false"){let r=await this._ApiUserChildrensAsLocations(n);if(r.length>0){r.forEach(i=>{t.target.closest("li").insertAdjacentHTML("afterend",this._ItemHtmlBox(i.login,n)),i.hasChildrens&&this._MoreChildrensButtonHtmlBoxAppend(i.login),this._ItemLineHtmlBoxAppend(i.login),document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+i.login+'"] ._SelectLocB')!=null&&document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+i.login+'"] ._SelectLocB').addEventListener("click",async()=>{let n=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+i.login+'"]'),t=n.getAttribute("data-issubscribed"),r=await this._ApiUserSubscriptionSet(i.login);r.ok&&(t=="true"?n.setAttribute("data-issubscribed",!1):n.setAttribute("data-issubscribed",!0),this._CheckedList=await this._ApiUsersLocationsChecked())})});i.setAttribute("data-loading",!0);i.setAttribute("data-display",!0);let u=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"]');u.getAttribute("data-issubscribed")=="false"||u.getAttribute("data-issubscribed")=="wait"?this._CheckedList.length>0&&this._CheckedList.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"]');t!=null?t.setAttribute("data-issubscribed",!0):n.parentLogins.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"]');t.getAttribute("data-issubscribed")=="false"&&t.setAttribute("data-issubscribed","wait")})}):u.getAttribute("data-issubscribed")=="true"&&r.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"]');t.setAttribute("data-issubscribed","null")})}}else i.getAttribute("data-display")=="true"?(document.querySelectorAll("#"+this.Name+' > ul > li > div[data-parentlogin="'+n+'"]').forEach(n=>{n.closest("li").style.display="none"}),i.setAttribute("data-display",!1)):(document.querySelectorAll("#"+this.Name+' > ul > li > div[data-parentlogin="'+n+'"]').forEach(n=>{n.closest("li").style.display="list-item"}),i.setAttribute("data-display",!0),mTy.getAttribute("data-issubscribed")=="false"||mTy.getAttribute("data-issubscribed")=="wait"?this._CheckedList.length>0&&this._CheckedList.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n.login+'"]');t!=null?t.setAttribute("data-issubscribed",!0):n.parentLogins.forEach(n=>{let t=document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"]');t.getAttribute("data-issubscribed")=="false"&&t.setAttribute("data-issubscribed","wait")})}):mTy.getAttribute("data-issubscribed")=="true"&&document.querySelectorAll("#"+this.Name+' > ul > li > div[data-parentlogin="'+n+'"]').setAttribute("data-issubscribed","null"))})}_HtmlPart(){return'<div id="'+this.Name+'">    <ul>    <\/ul><\/div>'}_ItemHtmlBox(n,t=null){let i="";t!=null&&(i='data-parentLogin="'+t+'"');let r="";this._RoleId>0&&(r='<a class="_SelectLocB">    <img /><\/a>');return'<li>    <div data-login="'+n+'"  '+i+' data-isSubscribed="false">        <a href="/i/-'+n+'">            <span>            '+n+"            <\/span>        <\/a>        "+r+"    <\/div><\/li>"}_ItemLineHtmlBoxAppend(n){document.querySelector("#"+this.Name+' > ul > li > div[data-login="'+n+'"]').insertAdjacentHTML("beforeend",'<div class="_LineB"><\/div>')}async _ApiUsersAsLocations(){const n=await fetch(this._ApiUrl+"/Base/Users/AsLocation",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+this._SessionToken}});return n.ok===!0?await n.json():null}async _ApiUsersLocationsChecked(){const n=await fetch(this._ApiUrl+"/Base/Users/Locations/Checked",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+this._SessionToken}});return n.ok===!0?await n.json():null}async _ApiUserSubscriptionSet(n){const t=await fetch(this._ApiUrl+"/RtInk/UserSubscriptionSet?userLogin="+n,{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+this._SessionToken}});return t.ok===!0?await t.json():null}async _ApiUserChildrensAsLocations(n){const t=await fetch(this._ApiUrl+"/Base/User/Childrens/AsLocation?login="+n,{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+this._SessionToken}});return t.ok===!0?await t.json():null}}